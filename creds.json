const {
    default: makeWASocket,
    useMultiFileAuthState,
    DisconnectReason,
    fetchLatestBaileysVersion,
    makeInMemoryStore
} = require('@whiskeysockets/baileys');
const pino = require('pino');
const fs = require('fs');

// --- ‡∂î‡∂∂‡∑ö ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂∏‡∑ô‡∂≠‡∑ê‡∂± ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ---
const SESSION_ID = '‡∂î‡∂∂‡∑ö_SESSION_ID_‡∂ë‡∂ö_‡∂∏‡∑ô‡∂≠‡∂±‡∂ß_‡∂Ø‡∂∏‡∂±‡∑ä‡∂±'; 
// ------------------------------------

async function startPrabathMD() {
    const { state, saveCreds } = await useMultiFileAuthState('session');
    const { version } = await fetchLatestBaileysVersion();

    const sock = makeWASocket({
        version,
        auth: state,
        printQRInTerminal: true,
        logger: pino({ level: 'silent' }),
        browser: ["Prabath-MD", "Safari", "3.0"]
    });

    sock.ev.on('creds.update', saveCreds);

    sock.ev.on('connection.update', (update) => {
        const { connection, lastDisconnect } = update;
        if (connection === 'close') {
            let reason = lastDisconnect.error?.output?.statusCode;
            console.log("‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∂≠‡∑è‡∑Ä‡∂∫ ‡∑Ä‡∑í‡∑É‡∂±‡∑ä‡∂∞‡∑í ‡∑Ä‡∑í‡∂∫. ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂∫‡∑í...");
            startPrabathMD();
        } else if (connection === 'open') {
            console.log('‚úÖ Prabath-MD ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞ ‡∑Ä‡∑í‡∂∫!');
            sock.sendMessage(sock.user.id, { text: '*‡∂∂‡∑ú‡∂ß‡∑ä ‡∑Ä‡∑ê‡∂© ‡∂Ö‡∂ª‡∂π‡∂∫‡∑í! üöÄ*' });
        }
    });

    // ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂© ‡∂Ω‡∑ê‡∂∂‡∑ô‡∂± ‡∑Ä‡∑í‡∂ß (Commands)
    sock.ev.on('messages.upsert', async (m) => {
        const msg = m.messages[0];
        if (!msg.message || msg.key.fromMe) return;

        const from = msg.key.remoteJid;
        const text = msg.message.conversation || msg.message.extendedTextMessage?.text || "";

        if (text.startsWith('.ping')) {
            await sock.sendMessage(from, { text: 'Speed: 100ms ‚ö°' });
        }
        
        if (text.startsWith('.alive')) {
            await sock.sendMessage(from, { text: '‡∂∏‡∂∏ ‡∂Ø‡∑ê‡∂±‡∂ß ‡∑É‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂∫‡∂∫‡∑í! (Alive) üõ°Ô∏è' });
        }
    });
}

startPrabathMD();
